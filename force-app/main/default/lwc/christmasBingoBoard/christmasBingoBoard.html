<template>
    <div class="bingo-container">
        <template if:true={isLoading}>
            <div class="loading-container">
                <lightning-spinner alternative-text="Loading" size="large"></lightning-spinner>
            </div>
        </template>
        
        <template if:false={isLoading}>
            <!-- Setup Instructions -->
            <template if:true={showSetupInstructions}>
                <div class="setup-instructions">
                    <div class="setup-content">
                        <h2 class="setup-title">ðŸŽ„ Welcome to Christmas Music Bingo! ðŸŽ„</h2>
                        <div class="setup-steps">
                            <template if:true={hasNoGame}>
                                <div class="setup-step">
                                    <div class="step-number">1</div>
                                    <div class="step-content">
                                        <h3>Create a Game</h3>
                                        <p>Go to the <strong>Song Selector</strong> page and click <strong>Admin</strong> to create your first game.</p>
                                    </div>
                                </div>
                            </template>
                            <template if:true={hasNoSongs}>
                                <div class="setup-step">
                                    <div class="step-number">{stepNumberForSongs}</div>
                                    <div class="step-content">
                                        <h3>Add Songs to Your List</h3>
                                        <p>In the <strong>Admin</strong> section, go to the <strong>Songs</strong> tab to add at least 24 songs to your song list.</p>
                                    </div>
                                </div>
                                <div class="setup-step">
                                    <div class="step-number">{stepNumberForAssign}</div>
                                    <div class="step-content">
                                        <h3>Assign Songs to Your Game</h3>
                                        <p>In the <strong>Lists</strong> tab, select a list and add at least 24 songs to it. Then assign that list to your game in the <strong>Games</strong> tab.</p>
                                    </div>
                                </div>
                            </template>
                            <template if:false={hasNoGame}>
                                <template if:false={hasNoSongs}>
                                    <div class="setup-step">
                                        <div class="step-number">1</div>
                                        <div class="step-content">
                                            <h3>Set Game as Active</h3>
                                            <p>In the <strong>Admin</strong> section, go to the <strong>Games</strong> tab and click <strong>Set Active</strong> on your game.</p>
                                        </div>
                                    </div>
                                </template>
                            </template>
                        </div>
                        <div class="setup-note">
                            <p><strong>Note:</strong> You need at least 24 songs in your game's song list to generate a bingo board.</p>
                        </div>
                    </div>
                </div>
            </template>
            
            <!-- Normal Bingo Board -->
            <template if:false={showSetupInstructions}>
                <div class="header-section">
                    <h1 class="game-title">
                        {activeGame.Event_Description__c}
                    </h1>
                    <button class="refresh-button" onclick={handleRefresh} type="button">
                        <svg class="refresh-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        New Board
                    </button>
                </div>
                
                <div class="bingo-board slds-grid slds-grid_vertical">
                    <template for:each={boardSongs} for:item="row">
                        <div key={row.rowKey} class="bingo-row">
                            <template for:each={row.items} for:item="song">
                                <div 
                                    key={song.songId}
                                    class={song.cssClass}
                                    onclick={handleSquareClick}
                                    data-songid={song.songId}>
                                    <div class="square-content">
                                        <template if:true={song.isFree}>
                                            <div class="free-square">FREE</div>
                                        </template>
                                        <template if:false={song.isFree}>
                                            <div class="song-name">{song.Name}</div>
                                        </template>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </template>
                </div>
                
                <div class="instructions-container">
                    <p class="instructions">Tap a square to mark it. Center square is FREE!</p>
                </div>
            </template>
        </template>
        
        <!-- Bingo Flash Overlay -->
        <template if:true={showBingoFlash}>
            <div class="bingo-flash-overlay" onclick={handleBingoFlashClick}>
                <div class="bingo-flash-content">
                    <div class="bingo-text">ðŸŽ„ BINGO! ðŸŽ„</div>
                    <div class="bingo-subtitle">Congratulations!</div>
                    <div class="bingo-instruction">Click anywhere to dismiss</div>
                </div>
            </div>
        </template>
    </div>
</template>

